<h3 class="mb-3">Sản phẩm mới</h3>
<div class="row mb-4">
  <% if (!newProducts || newProducts.length === 0) { %>
    <p>Chưa có sản phẩm mới.</p>
  <% } %>

  <% newProducts.forEach(p => { 
       const firstVariant = (p.variants && p.variants.length > 0) ? p.variants[0] : null;
  %>
    <div class="col-md-3 mb-3">
      <div class="card h-100">
        <a href="/products/<%= p._id %>">
          <img src="<%= p.thumbnail %>" class="card-img-top" alt="<%= p.name %>">
        </a>
        <div class="card-body d-flex flex-column">
          <h6 class="card-title">
            <a href="/products/<%= p._id %>" class="text-decoration-none text-dark">
              <%= p.name %>
            </a>
          </h6>
          <p class="mb-1 fw-bold text-danger">
            <%= p.basePrice.toLocaleString("vi-VN") %>₫
          </p>
          <p class="small mb-1">
            ⭐ <%= (p.ratingAverage || 0).toFixed(1) %> / 5 (
            <%= p.ratingCount || 0 %> đánh giá)
          </p>

          <div class="mt-auto d-flex flex-column gap-1">
            <a href="/products/<%= p._id %>" class="btn btn-sm btn-outline-primary w-100">
              Xem chi tiết
            </a>

            <% if (firstVariant) { %>
              <button
                type="button"
                class="btn btn-sm btn-warning w-100 btn-add-to-cart"
                data-product-id="<%= p._id %>"
                data-variant-id="<%= firstVariant._id %>"
                data-qty="1"
              >
                Thêm vào giỏ
              </button>
            <% } else { %>
              <button class="btn btn-sm btn-secondary w-100" disabled>
                Hết hàng
              </button>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  <% }) %>
</div>

<h3 class="mb-3">Bán chạy nhất</h3>
<div class="row mb-4">
  <% if (!bestSellers || bestSellers.length === 0) { %>
    <p>Chưa có sản phẩm bán chạy.</p>
  <% } %>

  <% bestSellers.forEach(p => { 
       const firstVariant = (p.variants && p.variants.length > 0) ? p.variants[0] : null;
  %>
    <div class="col-md-3 mb-3">
      <div class="card h-100">
        <a href="/products/<%= p._id %>">
          <img src="<%= p.thumbnail %>" class="card-img-top" alt="<%= p.name %>">
        </a>
        <div class="card-body d-flex flex-column">
          <h6 class="card-title">
            <a href="/products/<%= p._id %>" class="text-decoration-none text-dark">
              <%= p.name %>
            </a>
          </h6>
          <p class="mb-1 fw-bold text-danger">
            <%= p.basePrice.toLocaleString("vi-VN") %>₫
          </p>
          <p class="small mb-1">
            ⭐ <%= (p.ratingAverage || 0).toFixed(1) %> / 5 (
            <%= p.ratingCount || 0 %> đánh giá)
          </p>

          <div class="mt-auto d-flex flex-column gap-1">
            <a href="/products/<%= p._id %>" class="btn btn-sm btn-outline-primary w-100">
              Xem chi tiết
            </a>

            <% if (firstVariant) { %>
              <button
                type="button"
                class="btn btn-sm btn-warning w-100 btn-add-to-cart"
                data-product-id="<%= p._id %>"
                data-variant-id="<%= firstVariant._id %>"
                data-qty="1"
              >
                Thêm vào giỏ
              </button>
            <% } else { %>
              <button class="btn btn-sm btn-secondary w-100" disabled>
                Hết hàng
              </button>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  <% }) %>
</div>

<h3 class="mb-3">Laptop</h3>
<div class="row mb-4">
  <% if (!laptops || laptops.length === 0) { %>
    <p>Chưa có laptop.</p>
  <% } %>

  <% laptops.forEach(p => { 
       const firstVariant = (p.variants && p.variants.length > 0) ? p.variants[0] : null;
  %>
    <div class="col-md-3 mb-3">
      <div class="card h-100">
        <a href="/products/<%= p._id %>">
          <img src="<%= p.thumbnail %>" class="card-img-top" alt="<%= p.name %>">
        </a>
        <div class="card-body d-flex flex-column">
          <h6 class="card-title">
            <a href="/products/<%= p._id %>" class="text-decoration-none text-dark">
              <%= p.name %>
            </a>
          </h6>
          <p class="mb-1 fw-bold text-danger">
            <%= p.basePrice.toLocaleString("vi-VN") %>₫
          </p>
          <p class="small mb-1">
            ⭐ <%= (p.ratingAverage || 0).toFixed(1) %> / 5 (
            <%= p.ratingCount || 0 %> đánh giá)
          </p>

          <div class="mt-auto d-flex flex-column gap-1">
            <a href="/products/<%= p._id %>" class="btn btn-sm btn-outline-primary w-100">
              Xem chi tiết
            </a>

            <% if (firstVariant) { %>
              <button
                type="button"
                class="btn btn-sm btn-warning w-100 btn-add-to-cart"
                data-product-id="<%= p._id %>"
                data-variant-id="<%= firstVariant._id %>"
                data-qty="1"
              >
                Thêm vào giỏ
              </button>
            <% } else { %>
              <button class="btn btn-sm btn-secondary w-100" disabled>
                Hết hàng
              </button>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  <% }) %>
</div>

<h3 class="mb-3">Màn hình</h3>
<div class="row mb-4">
  <% if (!monitors || monitors.length === 0) { %>
    <p>Chưa có màn hình.</p>
  <% } %>

  <% monitors.forEach(p => { 
       const firstVariant = (p.variants && p.variants.length > 0) ? p.variants[0] : null;
  %>
    <div class="col-md-3 mb-3">
      <div class="card h-100">
        <a href="/products/<%= p._id %>">
          <img src="<%= p.thumbnail %>" class="card-img-top" alt="<%= p.name %>">
        </a>
        <div class="card-body d-flex flex-column">
          <h6 class="card-title">
            <a href="/products/<%= p._id %>" class="text-decoration-none text-dark">
              <%= p.name %>
            </a>
          </h6>
          <p class="mb-1 fw-bold text-danger">
            <%= p.basePrice.toLocaleString("vi-VN") %>₫
          </p>
          <p class="small mb-1">
            ⭐ <%= (p.ratingAverage || 0).toFixed(1) %> / 5 (
            <%= p.ratingCount || 0 %> đánh giá)
          </p>

          <div class="mt-auto d-flex flex-column gap-1">
            <a href="/products/<%= p._id %>" class="btn btn-sm btn-outline-primary w-100">
              Xem chi tiết
            </a>

            <% if (firstVariant) { %>
              <button
                type="button"
                class="btn btn-sm btn-warning w-100 btn-add-to-cart"
                data-product-id="<%= p._id %>"
                data-variant-id="<%= firstVariant._id %>"
                data-qty="1"
              >
                Thêm vào giỏ
              </button>
            <% } else { %>
              <button class="btn btn-sm btn-secondary w-100" disabled>
                Hết hàng
              </button>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  <% }) %>
</div>

<h3 class="mb-3">Ổ cứng</h3>
<div class="row mb-4">
  <% if (!storages || storages.length === 0) { %>
    <p>Chưa có ổ cứng.</p>
  <% } %>

  <% storages.forEach(p => { 
       const firstVariant = (p.variants && p.variants.length > 0) ? p.variants[0] : null;
  %>
    <div class="col-md-3 mb-3">
      <div class="card h-100">
        <a href="/products/<%= p._id %>">
          <img src="<%= p.thumbnail %>" class="card-img-top" alt="<%= p.name %>">
        </a>
        <div class="card-body d-flex flex-column">
          <h6 class="card-title">
            <a href="/products/<%= p._id %>" class="text-decoration-none text-dark">
              <%= p.name %>
            </a>
          </h6>
          <p class="mb-1 fw-bold text-danger">
            <%= p.basePrice.toLocaleString("vi-VN") %>₫
          </p>
          <p class="small mb-1">
            ⭐ <%= (p.ratingAverage || 0).toFixed(1) %> / 5 (
            <%= p.ratingCount || 0 %> đánh giá)
          </p>

          <div class="mt-auto d-flex flex-column gap-1">
            <a href="/products/<%= p._id %>" class="btn btn-sm btn-outline-primary w-100">
              Xem chi tiết
            </a>

            <% if (firstVariant) { %>
              <button
                type="button"
                class="btn btn-sm btn-warning w-100 btn-add-to-cart"
                data-product-id="<%= p._id %>"
                data-variant-id="<%= firstVariant._id %>"
                data-qty="1"
              >
                Thêm vào giỏ
              </button>
            <% } else { %>
              <button class="btn btn-sm btn-secondary w-100" disabled>
                Hết hàng
              </button>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  <% }) %>
</div>
